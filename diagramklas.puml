@startuml

' Ustawienia stylistyczne dla lepszej czytelności
skinparam classAttributeIconSize 0
skinparam linetype ortho
skinparam packageStyle rectangle

title Diagram Klas Systemu Gry w Go - Iteracja 1

' ---------------------------------------------------------
' PAKIET SHARED (Współdzielone)
' ---------------------------------------------------------
package "Shared (Wspólne)" {

    enum StoneColor {
        BLACK
        WHITE
        EMPTY
    }

    class Board {
        - int size
        - StoneColor[][] grid
        + Board(int size)
        + getStone(int x, int y) : StoneColor
        + setStone(int x, int y, StoneColor color) : void
        + removeStone(int x, int y) : void
        + getSize() : int
        + clear() : void
    }
}

' ---------------------------------------------------------
' PAKIET SERVER (Logika biznesowa i sieciowa)
' ---------------------------------------------------------
package "Server" {

    class GoServer {
        - static int port = 1111
        + main(String[] args)
        + start() : void
    }

    class Game {
        - PlayerHandler blackPlayer
        - PlayerHandler whitePlayer
        - PlayerHandler currentPlayer
        - Board board
        - GameLogic gameLogic
        - boolean gameOver = false
        - int consecutivePasses = 0
        + Game(PlayerHandler p1, PlayerHandler p2, int size)
        + processMove(int x, int y, PlayerHandler player) : synchronized void
        + processPass(PlayerHandler player) : synchronized void
        + processQuit(PlayerHandler player) : synchronized void
        - switchTurn() : void
        - broadcastMessage(String message) : void
        - endGame() : void
        - calculateScore(StoneColor color) : int
    }

    class PlayerHandler implements Runnable {
        - Socket socket
        - PrintWriter output
        - BufferedReader input
        - Game game
        - StoneColor color
        + PlayerHandler(Socket socket, StoneColor color)
        + run() : void
        + sendMessage(String msg) : void
        + setGame(Game game) : void
        + setColor(StoneColor color) : void
        + getColor() : StoneColor
        - setupStreams() : void
        - handleCommand(String command) : void
        - closeConnection() : void
    }

    class GameLogic {
        + validateMove(Board board, int x, int y) : boolean
        + checkCaptures(Board board, int x, int y, StoneColor color) : ArrayList<int[]>
        + finalCheck(Board board, int x, int y, StoneColor color) : StoneColor
        - countLiberties(Board board, int x, int y) : int
        - inBounds(Board board, int x, int y) : boolean
    }
}

' ---------------------------------------------------------
' PAKIET CLIENT (Warstwa prezentacji)
' ---------------------------------------------------------
package "Client" {

    class GoClient {
        + main(String[] args)
    }

    class ClientGameController {
        - Socket socket
        - PrintWriter out
        - ConsoleView view
        - StoneColor myColor = StoneColor.EMPTY
        - boolean isGameRunning = true
        - boolean myTurn = false
        + ClientGameController(Socket socket, ConsoleView view) throws Exception
        + play() : void
        + handleServerMessage(String message) : synchronized void
        + handleConnectionError() : void
        - handleUserInput(String input) : void
        - closeConnection() : void
    }

    class ServerListener implements Runnable {
        - BufferedReader in
        - ClientGameController controller
        + ServerListener(InputStream inputStream, ClientGameController controller)
        + run() : void
    }

    class ConsoleView {
        - Scanner scanner
        - Board board
        - String color
        - String msg = ""
        - String err = ""
        - boolean myTurn = false
        + ConsoleView(int size)
        + updateBoard(int x, int y, StoneColor color) : void
        + displayBoard() : void
        + setMessage(String msg) : void
        + getUserInput() : String
        + setColor(String color) : void
        + setTurn(boolean turn) : void
        + setErr(String err) : void
    }
}

' ---------------------------------------------------------
' RELACJE
' ---------------------------------------------------------

' Powiązania w serwerze
GoServer ..> Game : <<creates>>
GoServer ..> PlayerHandler : <<creates>>

Game "1" *-- "1" Board : zawiera (Composition)
Game "1" *-- "1" GameLogic : zawiera (Composition)
Game "1" o-- "2" PlayerHandler : zarządza (Aggregation)

GameLogic ..> Board : używa (Dependency)
GameLogic ..> StoneColor : używa

PlayerHandler ..> StoneColor : używa
PlayerHandler --> Game : współpracuje

' Powiązania w kliencie
GoClient ..> Socket : <<creates>>
GoClient ..> ConsoleView : <<creates>>
GoClient ..> ClientGameController : <<creates>>

ClientGameController "1" *-- "1" ConsoleView : używa
ClientGameController "1" *-- "1" ServerListener : zarządza

ServerListener --> ClientGameController : powiadamia

ConsoleView "1" *-- "1" Board : wyświetla
ConsoleView ..> Scanner : używa

' Powiązania między pakietami
Board *-- StoneColor : zawiera

' Dodatkowe relacje (z mojego diagramu)
Game --> StoneColor : używa
ClientGameController ..> StoneColor : używa
ConsoleView ..> StoneColor : używa

' Relacje komunikacyjne między klientem a serwerem
ClientGameController ..> Socket : komunikacja
PlayerHandler ..> Socket : komunikacja

@enduml